pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
--test bounce
--x=50
--y=50
--pos=0
--pos2=0
--pos3=0
--
--function _init()
--	cls(2)
--end
--
--function _update60()
-- x+=1
-- x%=128
-- pos3=pos2
-- pos2=pos
-- pos+=0.0125
-- pos%=1
--end
--
--function _draw()
-- cls(2)
---- circfill(x,y+sin(pos3)*10,2,3)
---- circfill(x,y+sin(pos2)*10,2,11)
-- circfill(x,y+sin(pos)*10,2,7)
--end
-->8
----test distort
--x=50
--y=50
--pos=0
--
--function _init()
--	cls(2)
--end
--
--function _update60()
-- pos+=0.03125
-- pos%=1
--end
--
--function _draw()
-- cls(2)
-- spr(3,60,50)
-- distort(3,60,60)
---- spr(3,60,60)
---- for i=0,1 do
----  for j=0,1 do
----   spr(1+i+16*j,50+8*i,50+8*j)
----  end
---- end
--end
--
--function distort(n,x,y)
-- sx=8*(n%16)
-- sy=8*flr((n/16))
-- for i=0,7 do
--  offset=flr(sin(0.125*i+pos))
--  for j=0,7 do
--   col=sget(sx+i,sy+j)
--   if col!=0 then  
----    printh(x+i)
----    printh(x+i+offset)
----    pset(x+j+offset,y+i,col)
--   end
--  end
----      printh("-------")
-- end
---- printh("******")
--end
-->8
----test big distort
--pos=0
--
--function _init()
--	cls(1)
--end
--
--function _update60()
-- pos+=0.03125
-- pos%=1
--end
--
--function _draw()
-- cls(1)
-- for i=0,1 do
--  for j=0,1 do
--   spr(1+i+16*j,50+8*i,30+8*j)
--   distort(1+j+16*i,50+8*i,50+8*j)
--  end
-- end
--end
--
--function distort(n,x,y)
-- sx=8*(n%16)
-- sy=8*flr((n/16))
-- for i=0,7 do
--  offset=flr(sin(0.125*i+pos))
--  for j=0,7 do
--   col=sget(sx+i,sy+j)
--   if col!=0 then  
--    pset(x+j+offset,y+i,col)
--   end
--  end
-- end
--end
-->8
--test map distortion

--function _init()
--pos=0
--flp=false
--px=50
--py=50
--f=0
--map()
--end

--function _update60()
-- f+=1
-- if f%2==0 then
--  drw=not drw
--  printh(drw)
-- end
-- pos+=0.015
-- pos%=1
-- if btn(⬅️) then
--  flp=true
--  px-=1
--  map()
-- elseif btn(➡️) then
--  flp=false
--  px+=1
--  map()
-- elseif btn(⬆️) then
--  py-=1
--  map()
-- elseif btn(⬇️) then
--  py+=1
--  map()
-- end
--end
--
--function _draw()
-- 	drawmap()
-- 	spr(10,px-20,py,1,1,flp)
-- 	if f%2!=0 then
-- 	 spr(10,px,py,1,1,flp)
-- 	end
-- 	rectfill(0,120,128,128,8)
-- 	print('cpu:'..stat(1),2,122,2)

-- cls(1)
-- for i=0,1 do
--  for j=0,1 do
--   spr(1+i+16*j,50+8*i,30+8*j)
--   distort(1+j+16*i,50+8*i,50+8*j)
--  end
-- end
--end

function drawmap()
	for row=0,1 do
	 for col=9,10 do
	  mtile=mget(row,col)
	  drawtile(mtile,row,col)
	 end
	end
--		for row=0,1 do
--	 for col=2,4 do
--	  mtile=mget(row,col)
--	  drawtilev(mtile,row,col)
--	 end
--	end
end

function drawtile(tile,row,col)
 x=tile%16
 y=flr(tile/16)
 for i=0,7 do
  offset=flr(sin(0.125*i+pos))
  for j=0,7 do
   clr=sget(x*8+j,y*8+i)
   for k=0,112,16 do
   	pset(row*8+j+offset+k,col*8+i,clr)
   end  
  end
 end
end


function drawtilev(tile,row,col)
 x=tile%16
 y=flr(tile/16)
 for i=0,7 do
  
  for j=0,7 do
  offset=flr(sin(0.05*j+pos))
   clr=sget(x*8+j,y*8+i)
   for k=0,112,16 do
   	pset(row*8+j+k,col*8+i+offset,clr)
   end  
  end
 end
end

--function distort(n,x,y)
-- sx=8*(n%16)
-- sy=8*flr((n/16))
-- for i=0,7 do
--  offset=flr(sin(0.125*i+pos))
--  for j=0,7 do
--   col=sget(sx+i,sy+j)
--   if col!=0 then  
--    pset(x+j+offset,y+i,col)
--   end
--  end
-- end
--end
-->8
--test video remapping
-->8
--test memcpy

function copy()
	-- copy ss to upper memory
	memcpy(0x4300,0x0000,1000)
 -- copy screen to ss
	memcpy(0x0000,0x6000, 8192)
end

function offset()
 -- sspr line by line w/ offset
 for y=0,119 do
 	off=flr(sin(0.125*(y%8)+p))
 	sspr(0,y,128,1,off,y)
 end
end

function swap()
	-- copy ss to upper memory
	memcpy(0x8000,0x0000,8192)
	-- copy upper memory to ss
	memcpy(0x0000,0x4300,1000)
end

function unswap()
	memcpy(0x4300,0x0000,1000)
	memcpy(0x0000,0x8000, 8192)
end
-->8
--base program

function _init()
	cls()
	map(0,0,0,0,16,16)
	copy()
	cls()
	p=0
	px=50
	py=50
	flpx=false
	flpy=false
	s=10
end

function _update60()
	p+=0.03125
 p%=1
 if btn(⬅️) then
  s=10
  flpx=true
  px-=1
 elseif btn(➡️) then
  s=10
  flpx=false
  px+=1
 elseif btn(⬆️) then
  s=11
  py-=1
  flpy=false
 elseif btn(⬇️) then
  s=11
  py+=1
  flpy=true
 end
end

function _draw()
	offset()
	swap()
	spr(s,px,py,1,1,flpx,flpy)
 unswap()
 rectfill(0,120,127,127,8)
	print('cpu:'..stat(1),2,122,2)
end



__gfx__
0000000000000777777000000077770011111111cccccccccccccccccccccccc1111111111111111007777000077770000000000000000000000000000000000
0000000000077777777770000777777011111111cccccccccccccccccccccccc1113311111311111077777700778877000000000000000000000000000000000
0070070000777777777777007777777711111111ccccccccc1c1c1c1cccccccc1113111111311111777777777778877700000000000000000000000000000000
0007700007777777777777707777777711111111cccccccccccccccccccccccc1113111113331111777778877777777700000000000000000000000000000000
0007700007777777777777707777777711111111cccccccc1c1c1c1ccccccc1c1113111113333111777778877777777700000000000000000000000000000000
0070070077777777777777777777777711111111cccccccc11111111ccc1cccc1113331111133311777777777777777700000000000000000000000000000000
0000000077777777777777770777777011111111ccccccccc1c1c1c1cccccccc3311331133113311077777700777777000000000000000000000000000000000
0000000077777777777777770077770011111111cccccccc11111111c1ccc1cc3111331133313311007777000077770000000000000000000000000000000000
00000000777777777777777700000000ffffffff000000001c111c11000000003311331113333311000000000000000000000000000000000000000000000000
00000000777777777777777700000000ffffffff0000000011111111000000001313311111113311000000000000000000000000000000000000000000000000
00000000777777777777777700000000ffffffff00000000111c1111000000001333311311133311000000000000000000000000000000000000000000000000
00000000077777777777777000000000ffffffff00000000111111c1000000001333313311133111000000000000000000000000000000000000000000000000
00000000077777777777777000000000ffffffff0000000011111111000000001133333111133311000000000000000000000000000000000000000000000000
00000000007777777777770000000000ffffffff0000000011111111000000001113311111133311000000000000000000000000000000000000000000000000
00000000000777777777700000000000ffffffff0000000011111111000000001113311111113311000000000000000000000000000000000000000000000000
00000000000007777770000000000000ffffffff0000000011111111000000001113311111113111000000000000000000000000000000000000000000000000
__map__
1819181918191819181918191819181918190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0809080908090809080908090809080908090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1819181918191819181918191819181918190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0809080908090809080908090809080908090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1819181918191819181918191819181918190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0809080908090809080908090809080908090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1819181918191819181918191819181918190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0809080908090809080908090809080908090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1819181918191819181918191819181918190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0809080908090809080908090809080908090809000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1819181918191819181918191819181918191819000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0809080908090809080908090809080908090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1819181918191819181918191819181918190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0809080908090809080908090809080908090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1819181918191819181918191819181918190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0809080908090809080908090809080908090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1819181918191819181918191819181918190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1819181918191819181918191819181900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
